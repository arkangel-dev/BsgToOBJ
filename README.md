# BsgToOBJ v0.4 (English)

> **Disclaimer: ** This version of the converter is a forked from https://github.com/Pro-Nou/BsgToOBJ. This version has been merely translated to English. Also I used Google Translate for some parts of this document, so it might not make 100% sense. But you'll get the gist.

Besiege mechanical archive to OBJ model tool by ProNou. This tool uses Visual Studio community 2017, c++10 for development and compilation, and uses DirectX12 function library for model mesh conversion. The tool itself and any files generated by the tool are only suitable for learning and communication, and commercial use is prohibited.
If the above regulations are violated, any consequences caused shall be borne by the users who violate the regulations.



## Usage

### Path setting

- This converter obtains the path of the Besiege folders by reading it from the file `BSGPath.txt`. Before you can use it, you must change the file paths in this file to the correct directory if they are not already set correctly. The default paths will be fine if you have installed steam on `C:\Program Files (x86)\Steam\`. If not, you must change it other wise the converter will fail to get the meshes needed.

- ```xml
  // Set this to the SavedMachines folder on your system
  <saveM>C:\Program Files (x86)\Steam\steamapps\common\Besiege\Besiege_Data\SavedMachines\</saveM>
  
  // Set this to the skin folder in your Besiege data folder
  <skin>C:\Program Files (x86)\Steam\steamapps\common\Besiege\Besiege_Data\Skins\</skin>
  
  // Set this to the Steam Workshop folder for Besiege
  <workShop>C:\Program Files (x86)\Steam\steamapps\workshop\content\346010\</workShop>
  <saveL></saveL>
  
  ```



### Mesh Normalization Settings

> **Note: ** You can skip this step

- In Besiege, the meshes are not normalized. So before objects can be arranged, they have to be normalized so they all have the correct scale, rotation and position. In the future if Spiderling Studios add a new block or change the normalization parameters of existing blocks, you can update it by editing the file `block table.csv`. You can get the new parameters from here https://besiege.fandom.com/wiki/Skin_Model_Transforms



### Import Parameters

> **Note :** You can skip this step

- The settings for the imported objects are located in the text file `BSGsetting.txt`. The following table will describe how each setting works

| Tag                         | Description                                                  |
| --------------------------- | ------------------------------------------------------------ |
| `<minimal-cylinder-length>` | This value describes how short a winch, contract or brace block have to be |
| `<surface-step>`            | This value defines how smooth the surface blocks will be when its imported |
| `<surface-step-angle>`      | Similar to <surface-step>, this value defines when the new skin is subdivided, The approximate arc between the points on the same side, the default is 5. |
| `<glass-alpha>`             | This value defines the transparency when the new skin is glass. |



### Running the application

- Now you ca finally run the application. When you run it, you'll be prompted to enter the name of the BSG file you want to import. Type in the name without the file name extension. For example if the file is `CoolCreation.bsg` type in `CoolCreation` only. Also note that the file have to be located in the `SavedMachines` folder of your Besiege data folder. Once the file has been converted, the application will create an OBJ file along with a MTL file in the current working directory



## Change Log

- v0.4.1 (2021/1/9)
  - Fixed an issue where the skin thickness is only half of the in-game
- v0.4 2021/1/7
  - Added a new angle-based skin resolution step size, which can be set in the configuration file. Now the step size will be set by combining the side length and the side radian
  - Corrected the d value of the .mtl file, now the transparency of the glass can be set in the configuration file
- v0.3 2021/1/6
  - Increase the configuration file, now you can customize the identification length threshold of the fixed-point steel
  - Increase the new skin resolution step size, which can be set in the configuration file
  - *The Kd value of the .mtl file in blender is not correctly overlapped with map_Kd. After coloring is enabled, the texture map of the new skin will be stored as map_Ks, which is the highlight in blender, which is quite different from the rendering effect of the bsg body, and the material must be set manually mixing
  - *The d value of the .mtl file in Blender is not valid. When the new skin material is glass, the alpha channel of the corresponding material must be manually enabled
- v0.2 2021/1/5
  - Added new skin support, now you can convert the new skin
  - Increase the timing function, now the generated model will use "Archive name (generation time)" as the file name
  - Correct the angle error of sliding blade and detection block
  - Correct the calculation error of the length of steel bar, rubber band and winch
  - *When the new skin material is glass, the texture map of the corresponding material in the .mtl file is a relative path, and the Blocks folder and the .mtl file must be placed in the same folder
- v0.1 2020/10/19
  - Miscellaneous corrections
  - Officially released
- a0.5 2020/10/18
  - Improved anti-misreading mechanism based on vt, vn count
  - Correct the normal conversion error
  - Fix UTF8 garbled
  - The compilation mode is changed to release
- a0.4 2020/10/17
  - Correct the angle of deformed steel
  - Fix the bug that when the archive stores skins in local form, but there is no such skin locally, sometimes the skin is not read in the workshop
- a0.3 2020/10/16
  - Increase reading and conversion of steel bars, rubber bands, and winches
  - Add .mtl material library generation
  - Amend the .obj reading strategy, now supports .obj exported by 3dmax, and add anti-misreading mechanism
  - Modify parts list parameters
  - *Wrong angle of deformed steel
- a0.2 2020/10/14
  - Add prefab-based parts list construction
  - Increase most part model reading and conversion
  - *Some parts are converted incorrectly
- a0.1 2020/10/13
  - Add .obj read and convert
  - Increase .bsg reading
  - Increase .obj generation



